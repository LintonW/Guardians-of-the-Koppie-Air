<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Air Guardian</title>

        <!-- A-Frame core library -->
        <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

        <!-- Load AR.js library for A-Frame -->
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

        <!-- Look-at component -->
        <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

        <style>
            body {
                margin: 0;
                overflow: hidden;
                font-family: Arial, sans-serif;
            }

            /* Dialogue box styling */
            #dialogueBox {
                position: fixed;
                bottom: 20px;
                left: 20px;
                right: 20px;
                background: rgba(0, 0, 0, 0.85);
                color: white;
                border-radius: 20px;
                padding: 15px 20px;
                font-size: 15px;
                line-height: 1.4;
                display: none;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            }

            #dialogueBox strong {
                display: block;
                font-size: 13px;
                color: #ccc;
                font-style: italic;
                margin-bottom: 5px;
            }

            .highlight {
                color: #d9fdfc;
            }
        </style>
    </head>
    <body>
        <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
            <a-marker type="pattern" url="assets/patterns/star-pattern.patt">
                <a-entity rotation="-90 0 0">
                    <a-entity
                        id="airRunestone"
                        gltf-model="assets/air/air-runestone.glb"
                        rotation="0 -90 0"
                        scale="1 1 1"
                        class="clickable">
                        <!-- "Tap to Start" prompt -->
                        <a-image
                            id="tapToStart4"
                            src="assets/tap-to-start.svg"
                            position="0 1.5 0"
                            width="1"
                            height="1"
                            look-at="[camera]"></a-image>
                    </a-entity>
                </a-entity>
            </a-marker>

            <a-entity camera cursor="fuse: false; rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
        </a-scene>

        <!-- HTML audio element for the guardian's theme music -->
        <audio id="airGuardianAudio" src="assets/air/air-guardian-theme.mp3" preload="auto"></audio>

        <!-- Dialogue box -->
        <div id="dialogueBox">
            <strong>Air Guardian</strong>
            <span id="dialogueText"></span>
        </div>

        <script>
            // Wait for the A-Frame scene to finish loading
            document.querySelector("a-scene").addEventListener("loaded", function () {
                // Get references to the model, tap image, and audio elements
                const airRunestone = document.querySelector("#airRunestone");
                const airTapImage = airRunestone.querySelector("#tapToStart4");
                const airSound = document.querySelector("#airGuardianAudio");
                const dialogueBox = document.querySelector("#dialogueBox");
                const dialogueText = document.querySelector("#dialogueText");

                // Dialogue lines
                const dialogues = [
                    "It was a long and hard battle, but we <span class='highlight'>won</span>.",
                    "The smoke cleared, and <span class='highlight'>silence</span> returned to the koppie.",
                    "But even <span class='highlight'>peace</span> fades without memory.",
                    "Take this final fragment, and return it to the <span class='highlight'>heart</span> of the koppie.",
                ];

                // Add a click event listener to the model
                airRunestone.addEventListener("click", (e) => {
                    // Swap the runestone model with the guardian model
                    airRunestone.setAttribute("gltf-model", "assets/air/air-guardian.glb");
                    airRunestone.setAttribute("scale", "3 3 3");
                    airRunestone.setAttribute("animation-mixer", "");
                    airRunestone.setAttribute("rotation", "0 0 0");

                    // Hide the "Tap to Start" prompt
                    airTapImage.setAttribute("visible", "false");

                    // Play the guardian's theme music
                    airSound.play();

                    // Start dialogue
                    dialogueBox.style.display = "block";
                    let i = 0;
                    dialogueText.innerHTML = dialogues[i];
                    i++;

                    const interval = setInterval(() => {
                        if (i < dialogues.length) {
                            dialogueText.innerHTML = dialogues[i];
                            i++;
                        } else {
                            clearInterval(interval);
                        }
                    }, 5000); // Change every 5 seconds
                });
            });
        </script>
    </body>
</html>
